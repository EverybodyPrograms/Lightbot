<html>
	<head>
		<title>Cursebot</title>
		<script src="https://sirjosh3917.github.io/EEJSIDE/js/PlayerIOClient.development.js"></script>
		<script src="https://sirjosh3917.github.io/EEJSIDE/js/jsparse_clean.js"></script>
		<script src="https://sirjosh3917.github.io/EEJSIDE/js/BlockHandler.js"></script>
		<script src="https://sirjosh3917.github.io/EEJSIDE/js/ConnectHandler.js"></script>
		<link  href="https://sirjosh3917.github.io/EEJSIDE/styles.css" rel="stylesheet"/>
		<link rel="shortcut icon" type="image/png" href="curse.png"/>
		<style>
			body {
				font-family: monospace;
			}
			a {
				text-decoration: bold;
			color: #DDD
			}	
			h1,h2,p {
				color: white;
				text-align: center;
				font-family: monospace;
			}
			h3,h4,h5,h6 {
				color: white;
				font-family: monospace;
			}
			
			* {
			box-sizing: border-box;
			}
			label {
				color:white;
				font-size:12px;
			}

			input[type=checkbox]:hover {
				box-shadow:0px 0px 10px #1300ff;
			}
			body {
			  margin: 0;
			}
			/* Create three equal columns that floats next to each other */
			.column.settings {
				float: left;
				width: 30%;
				padding: 15px;
			}
			.column.input {
				float: left;
				width: 70%;
				padding: 15px;
			}

			/* Clear floats after the columns */
			.row:after {
				content: "";
				display: table;
				clear: both;
			}
			/* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
			@media screen and (max-width:417px) {
				.column.settings, .column.input {
					width: 100%;
				}
			}
		</style>
	</head>

	<body>

		<h1>Cursebot Online v1.1</h1>
		<p>Currently admin/banlists dont work, working on it tommorow. Report bugs to the <a href="https://github.com/EverybodyPrograms/Cursebot">github page.</a></p>

		<div class="row">


			<div class="column settings">

				<h3>Settings</h3>
				<h5>These settings save in localhost, they will persist until removed manually<br>(hopefully)</h5>

				<form>
				<!--	<label> Username</label>
					<input id="textbox"type="text" name="username"><br> -->

					<input id="snakebox" type="checkbox" name="snake" value="Snake" style="color: white"><label> Snake<br></label>

					<input id="crownbox" type="checkbox" name="crown" value="Crowntowin" style="color: white"><label> Crown to win<br></label>

					<input id="trophybox" type="checkbox" name="trophy" value="Trophytowin" checked style="color: white"><label> Trophy to win<br></label>
					
					<input id="adminbox" type="checkbox" name="admins" value="Admins" disabled="disabled" checked style="color: white"><label> Admins<br></label>
					<input id="banbox" type="checkbox" name="bans" value="Bans" disabled="disabled" checked style="color: white"><label> Bans<br></label>
					
					<input id="friendbox" type="checkbox" name="friendsgetedit" value="Friendsgetedit" checked style="color: white"><label> Friends get edit<br></label>
					
					<input id="welcomebox" type="checkbox" name="welcomes" value="Welcomes" checked style="color: white"><label> Welcomes<br></label>
					
					<input id="byebox" type="checkbox" name="goodbyes" value="Goodbyes" checked style="color: white"><label> Goodbyes<br></label>
					
					<input id="deathbox" type="checkbox" name="deaths" value="deaths" checked style="color: white"><label> Death commands<br><br></label>
					
					<!-- <input type="text" id="userInput"/> -->

				</form>
				<input type="button" value="Submit" onclick="submit();">
			</div>

			<div class="column input">
				<table class="menu" style="width: 90%; margin-left: 5%; margin-right: 5%; margin-top: 15%;">
					<tbody>
						<tr><td><input id="input-email" type="text" placeholder="Username"/></td></tr>
						<tr><td><input id="input-password" type="password" placeholder="Password"/></td></tr>
						<tr><td><input id="input-worldid" type="text" placeholder="World ID" value="PWVzwJeNbUb0I"/></td></tr>
						<tr><td><input onclick="connect();" type="button" value="Connect"></td></tr>
						<tr><td><textarea id="log" rows=8></textarea></td></tr>
					</tbody>
				</table>
			</div>
	</div>
		<script>



			function submit() {
				try{snakeON = document.getElementById('snakebox'  ).checked;}catch(err){snakeON = false;}
				try{crowntowin = document.getElementById('crownbox'  ).checked;}catch(err){crowntowin = false;}
				try{trophytowin = document.getElementById('trophybox' ).checked;}catch(err){trophytowin = false;}
				admins = false;
				bans = false;
				try{friendsgetedit = document.getElementById('friendbox' ).checked;}catch(err){friendsgetedit = false;}
				try{welcomes = document.getElementById('welcomebox').checked;}catch(err){welcomes = false;}
				try{goodbyes = document.getElementById('byebox'    ).checked;}catch(err){goodbyes = false;}
				try{deathCommands = document.getElementById('deathbox'  ).checked;}catch(err){deathCommands = false;}
				try{adminInput = document.getElementById("userInput").value; }catch(err){adminInput = false;}
			}
//
		//	function getCookie(cname) {
//
		//		document.cookie = "username=John Doe; expires=2147483647; path=/";
		//		document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; //path=/;";
//
		//		var name = cname + "=";
		//		var decodedCookie = decodeURIComponent(document.cookie);
		//		var ca = decodedCookie.split(';');
//				for(var i = 0; i <ca.length; i++) {
		////			var c = ca[i];
////					while (c.charAt(0) == ' ') {
		////				c = c.substring(1);
//		//			}
		////			if (c.indexOf(name) == 0) {
//		//				return c.substring(name.length, c.length);
		////			}
//		//		}
		//		return "";
		//	}
			function connect() {
				let __EEJSIDE___ = document.getElementById("input-email");
				let __EEJSIDE____ = document.getElementById("input-password");
				let __EEJSIDE_____ = document.getElementById("input-worldid");
				let __EEJSIDE______ = document.getElementById("log");
				let __EEJSIDE_______ = function(msg, name = "EEJSIDE") {
					__EEJSIDE______.innerHTML += new Date().toUTCString() + " [" + name + "]: " + msg + "\n";
					__EEJSIDE______.scrollTo(0, __EEJSIDE______.scrollHeight);
				};
				
				var client;
				var connection;
				var log = function(msg) {
					__EEJSIDE_______(msg, "BOT");
				}
				
				__EEJSIDE_______("Authenticating");
				Promise.resolve(authenticate(__EEJSIDE___.value, __EEJSIDE____.value).then(__EEJSIDE_ => {
					
					__EEJSIDE_______("Joining Room");
					Promise.resolve(joinRoom(__EEJSIDE_.cli, __EEJSIDE_.cfg, __EEJSIDE_____.value).then(__EEJSIDE__ => {
						
						__EEJSIDE_______("Running User Script");
						client = __EEJSIDE_.cli;
						connection = __EEJSIDE__.con;

						//Here is where your bot code is!

 // Demo JS Code - try pressing "connect" and then "compile"!
//
// This IDE includes for you:
// BlockHandler.js
// jsparse_clean.js
//
// So you can use whatever functions those have in your code!
//
// ~by SirJosh3917/ninjasupeatsninja

// BOT PLAN:
// make a bot that will run a curse tag minigame:
// - track players DONE
// - sense when a round starts DONE?
// - give a random player curse for 10-30 seconds
// - end round when one player is left
// - clear player of effects
// - give them coin
// - restart round

// EXTENDED PLAN:
// make the bot for general boss use
// - match smiley mini
// - random boss themes?
// - better reward system
// - save progress into file

// please only use var, 'let' will give you errors.
var testVar;
var playerid;
var team;
var ownerUsername;
var ownerID;
//class player {
//    constructor(username, playing)
//};
var player = [];
var playing = [];
// add a callback handler
connection.addMessageCallback("*", function(m) {
	switch(m.type) {
			
		// on "init"
		case "init": {
			ownerUsername = m.getString(0);

			// send "init2"
			connection.send("init2");
		} break;
			
		// on "init2"
		case "init2": {
			
			// say "Hello, World!"
			connection.send("say", "[CURSEBOT by joo456] Joined!");
			connection.send("m", 11*16, 8*16, 0, 0, 0, 0, 0, 0, 0, false, false, 0);
			connection.send("say", "/killall")
		} break;
			
		case "add": {
			var userid = m.getInt(0);
			var username = m.getString(1);

			if (username == ownerUsername) {
				ownerID = userid;
			}
			player[userid] = username;
			//var 
			connection.send("say", "[DEBUG] " + username +" (" +userid+")" + " joined");
		} break;
			
		// when someone says something
		case "say": {
			
			playerid = m.getInt(0);
			input = m.getString(1);
			// if they said "!download"
			if(input == "g") {
				
				// tell them that
				connection.send("pressKey", 51, 9, "green");
				connection.send("say", "[CURSEBOT] Game started!");
			}
			else if(input == "c") {
				connection.send("say", "/giveeffect " + playing[Math.floor(Math.random()*playing.length)] + " curse 20");
			}

			if(playerid == ownerID) {
				if(input == "aplaying") {
				connection.send("pm", playerid, "Playing: " + playing.toString())
			}	
			}
				
		} break;
	
		case "team": {


			playerid = m.getInt(0);
			team = m.getInt(1);
			
			if (team == 0) {
				playerid = m.getInt(0);
				removePlaying(player[playerid])
			}

			if (team == 1) {
			   // connection.send("say", "[DEBUG] USER CLEARED OF EFFECTS: " + player[playerid]);
				if ( ! (playing.includes(player[playerid]) ) )  {
				playing[playing.length] = player[playerid];
				connection.send("say", player[playerid] + " added to playing array") }
				connection.send("say", "/ce " + player[playerid]);
				// /giveeffect JOO456 curse 10
			}

			if (team == 5) {
			   // connection.send("say", "[DEBUG] USER CLEARED OF EFFECTS: " + player[playerid]);
				//playing[playerid] = player[playerid];
				connection.send("say", "/ce " + player[playerid]);
				// /giveeffect JOO456 curse 10
			}
			
			//playerid = m.getInt(0);
			//team = m.getInt(1);
			//connection.send("say", "i am a bot and i am testing teams");
			//connection.send("say", "pid" + String(playerid));
			//connection.send("say", "team" + String(team));		
		} break;

		case "kill": {
			playerid = m.getInt(0);
			removePlaying(player[playerid])
		} break;



		//case "team": {
	   // case "m": {

		  //  playerid = m.getInt(0);
		 //   connection.send("pm",505, "[DEBUG] USERID: " + m.getDouble(8));
			
			//(m.getInt(8) == -1) {
			//    connection.send("pm",505, "[DEBUG] USERID: " + playerid);
				//playing[playerid] = player[playerid];
				//connection.send("say", "/ce " + player[playerid]);
				// /giveeffect JOO456 curse 10
		 //   }
			
			//playerid = m.getInt(0);
			//team = m.getInt(1);
			//connection.send("say", "i am a bot and i am testing teams");
			//connection.send("say", "pid" + String(playerid));
			//connection.send("say", "team" + String(team));
			
	//	} break;
		
		
			
		
	}
});

function removePlayer(value) {

player = player.filter(function(item) { 
	return item !== value
})
}

function removePlaying(value) {

playing = playing.filter(function(item) { 
	if (playing.includes(player[playerid])) {
		connection.send("say", player[playerid] + " removed from playing array")
		return item !== value
	}

})
}

// send "init"
connection.send("init");



						//Here's where your bot code ends!
					}).catch(__EEJSIDE__ => {
						__EEJSIDE_______("Error Joining Room: " + __EEJSIDE__);
					}));
				}).catch(__EEJSIDE_ => {
					__EEJSIDE_______("Error Authenticating: " + __EEJSIDE_);
				}));
			}
		</script>
	</body>
</html>
